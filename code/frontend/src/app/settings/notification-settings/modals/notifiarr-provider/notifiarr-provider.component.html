<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="instance-modal"
  header="Configure Notifiarr Provider"
  (onHide)="onCancel()">
  
  <form [formGroup]="providerForm" class="p-fluid instance-form">
    <!-- Enabled Toggle -->
    <div class="field flex flex-row">
      <label class="field-label">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Enable or disable this notification provider"></i>
        Enabled
      </label>
      <div class="field-input">
        <p-checkbox formControlName="enabled" [binary]="true"></p-checkbox>
        <small class="form-helper-text">Enable this notification provider</small>
      </div>
    </div>

    <!-- Provider Name -->
    <div class="field">
      <label for="provider-name">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="A unique name to identify this provider"></i>
        Provider Name *
      </label>
      <input 
        id="provider-name"
        type="text" 
        pInputText 
        formControlName="name" 
        placeholder="My Notifiarr Provider"
        class="w-full" />
      <small *ngIf="hasError('name', 'required')" class="p-error">
        Provider name is required
      </small>
    </div>

    <!-- API Key Field -->
    <div class="field">
      <label for="api-key">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Your Notifiarr API key from your dashboard"></i>
        API Key *
      </label>
      <input 
        id="api-key"
        type="password" 
        pInputText 
        formControlName="apiKey" 
        placeholder="Enter your Notifiarr API key"
        class="w-full" />
      <small *ngIf="hasError('apiKey', 'required')" class="p-error">API Key is required</small>
      <small *ngIf="hasError('apiKey', 'minlength')" class="p-error">API Key must be at least 10 characters</small>
      <small class="form-helper-text">Your Notifiarr API key from your dashboard. Requires Passthrough integration.</small>
    </div>

    <!-- Channel ID Field -->
    <div class="field">
      <label for="channel-id">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="The Discord channel ID where notifications will be sent"></i>
        Discord Channel ID *
      </label>
      <input 
        id="channel-id"
        type="text" 
        pInputText 
        formControlName="channelId" 
        placeholder="Enter Discord channel ID"
        class="w-full" />
      <small *ngIf="hasError('channelId', 'required')" class="p-error">Channel ID is required</small>
      <small *ngIf="hasError('channelId', 'pattern')" class="p-error">Channel ID must be a valid Discord channel ID (numbers only)</small>
      <small class="form-helper-text">The Discord channel ID where notifications will be sent.</small>
    </div>

    <!-- Event Triggers Section -->
    <div class="field">
      <label>
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Select which events trigger notifications"></i>
        Notification Events
      </label>
      <div class="grid">
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onFailedImportStrike" [binary]="true" inputId="on-failed-import-strike"></p-checkbox>
            <label for="on-failed-import-strike" class="ml-2">On Failed Import Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onStalledStrike" [binary]="true" inputId="on-stalled-strike"></p-checkbox>
            <label for="on-stalled-strike" class="ml-2">On Stalled Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onSlowStrike" [binary]="true" inputId="on-slow-strike"></p-checkbox>
            <label for="on-slow-strike" class="ml-2">On Slow Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onQueueItemDeleted" [binary]="true" inputId="on-queue-item-deleted"></p-checkbox>
            <label for="on-queue-item-deleted" class="ml-2">On Queue Item Deleted</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onDownloadCleaned" [binary]="true" inputId="on-download-cleaned"></p-checkbox>
            <label for="on-download-cleaned" class="ml-2">On Download Cleaned</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onCategoryChanged" [binary]="true" inputId="on-category-changed"></p-checkbox>
            <label for="on-category-changed" class="ml-2">On Category Changed</label>
          </div>
        </div>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="modal-footer">
      <button 
        pButton 
        type="button" 
        label="Cancel" 
        class="p-button-text"
        (click)="onCancel()">
      </button>
      <button 
        pButton 
        type="button" 
        label="Test" 
        icon="pi pi-play"
        class="p-button-outlined ml-2"
        [disabled]="providerForm.invalid || testing"
        [loading]="testing"
        (click)="onTest()">
      </button>
      <button 
        pButton 
        type="button" 
        label="Save" 
        icon="pi pi-save"
        class="p-button-primary ml-2"
        [disabled]="providerForm.invalid || saving"
        [loading]="saving"
        (click)="onSave()">
      </button>
    </div>
  </ng-template>
</p-dialog>
