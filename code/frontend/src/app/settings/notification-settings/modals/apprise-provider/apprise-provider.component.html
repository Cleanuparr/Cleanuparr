<app-notification-provider-base
  [visible]="visible"
  modalTitle="Configure Apprise Provider"
  [saving]="saving"
  [testing]="testing"
  [editingProvider]="editingProvider"
  (save)="onSave($event)"
  (cancel)="onCancel()"
  (test)="onTest($event)"
>
  <!-- Provider-specific configuration goes here -->
  <div slot="provider-config">
    <!-- Mode Selection -->
    <div class="field">
      <label for="mode">
        <i
          class="pi pi-question-circle field-info-icon"
          title="Click for documentation"
          (click)="openFieldDocs('apprise.mode')"
        ></i>
        Mode *
      </label>
      <p-select
        id="mode"
        [options]="modeOptions"
        [formControl]="modeControl"
        optionLabel="label"
        optionValue="value"
        class="w-full"
        [showClear]="false"
      ></p-select>
      <small class="form-helper-text">
        API mode requires an external Apprise container. CLI mode uses the Apprise CLI directly, but requires installation for non-Docker users.
      </small>
    </div>

    <!-- CLI Availability Loading -->
    <div *ngIf="modeControl.value === 'Cli' && checkingCliAvailability" class="cli-detection-loading mb-3">
      <p-progressSpinner styleClass="w-1rem h-1rem"></p-progressSpinner>
      <span>Detecting local Apprise version...</span>
    </div>

    <!-- CLI Availability Warning -->
    <p-message
      *ngIf="modeControl.value === 'Cli' && !checkingCliAvailability && !cliAvailable"
      severity="warn"
      styleClass="w-full mb-3"
    >
      Apprise CLI not detected.&nbsp;
      <a href="https://github.com/caronc/apprise#installation" target="_blank" rel="noopener">
        Installation Guide
      </a>
    </p-message>

    <!-- CLI Available Info -->
    <p-message
      *ngIf="modeControl.value === 'Cli' && !checkingCliAvailability && cliAvailable && cliVersion"
      severity="success"
      styleClass="w-full mb-3"
      [text]="'Apprise CLI detected: ' + cliVersion"
    ></p-message>

    <!-- API Mode Fields -->
    <ng-container *ngIf="modeControl.value === 'Api'">
      <!-- Apprise Server URL -->
      <div class="field">
        <label for="full-url">
          <i
            class="pi pi-question-circle field-info-icon"
            title="Click for documentation"
            (click)="openFieldDocs('apprise.url')"
          ></i>
          Apprise Server URL *
        </label>
        <input
          id="full-url"
          type="url"
          pInputText
          [formControl]="urlControl"
          placeholder="http://localhost:8000"
          class="w-full"
        />
        <small *ngIf="hasFieldError(urlControl, 'required')" class="form-error-text">URL is required</small>
        <small *ngIf="hasFieldError(urlControl, 'invalidUri')" class="form-error-text">Must be a valid URL</small>
        <small *ngIf="hasFieldError(urlControl, 'invalidProtocol')" class="form-error-text">Must use http or https protocol</small>
        <small class="form-helper-text">The URL of your Apprise server where notifications will be sent.</small>
      </div>

      <!-- Configuration Key -->
      <div class="field">
        <label for="key">
          <i
            class="pi pi-question-circle field-info-icon"
            title="Click for documentation"
            (click)="openFieldDocs('apprise.key')"
          ></i>
          Configuration Key *
        </label>
        <input id="key" type="text" pInputText [formControl]="keyControl" placeholder="my-config-key" class="w-full" />
        <small *ngIf="hasFieldError(keyControl, 'required')" class="form-error-text">Configuration key is required</small>
        <small *ngIf="hasFieldError(keyControl, 'minlength')" class="form-error-text">Key must be at least 2 characters</small>
        <small class="form-helper-text">The key that identifies your Apprise configuration on the server.</small>
      </div>

      <!-- Tags -->
      <div class="field">
        <label for="tags">
          <i
            class="pi pi-question-circle field-info-icon"
            title="Click for documentation"
            (click)="openFieldDocs('apprise.tags')"
          ></i>
          Tags (Optional)
        </label>
        <input
          id="tags"
          type="text"
          pInputText
          [formControl]="tagsControl"
          placeholder="tag1,tag2 or tag3 tag4"
          class="w-full"
        />
        <small class="form-helper-text"
          >Optional tags to filter notifications. Use comma (,) to OR tags and space ( ) to AND them.</small
        >
      </div>
    </ng-container>

    <!-- CLI Mode Fields -->
    <ng-container *ngIf="modeControl.value === 'Cli'">
      <!-- Service URLs -->
      <div class="field">
        <label for="serviceUrls">
          <i
            class="pi pi-question-circle field-info-icon"
            title="Click for documentation"
            (click)="openFieldDocs('apprise.serviceUrls')"
          ></i>
          Service URLs *
        </label>
        <app-mobile-autocomplete
          [formControl]="serviceUrlsControl"
          placeholder="Add service URL and press Enter"
        ></app-mobile-autocomplete>
        <small class="form-helper-text">
          Add Apprise service URLs. Example: discord://webhook_id/token.
          <a href="https://github.com/caronc/apprise/wiki#notification-services" target="_blank" rel="noopener">
            View all supported services
          </a>
        </small>
      </div>
    </ng-container>
  </div>
</app-notification-provider-base>
