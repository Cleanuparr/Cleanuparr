<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="instance-modal"
  header="Configure Apprise Provider"
  (onHide)="onCancel()">
  
  <form [formGroup]="providerForm" class="p-fluid instance-form">
    <!-- Enabled Toggle -->
    <div class="field flex flex-row">
      <label class="field-label">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Enable or disable this notification provider"></i>
        Enabled
      </label>
      <div class="field-input">
        <p-checkbox formControlName="enabled" [binary]="true"></p-checkbox>
        <small class="form-helper-text">Enable this notification provider</small>
      </div>
    </div>

    <!-- Provider Name -->
    <div class="field">
      <label for="provider-name">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="A unique name to identify this provider"></i>
        Provider Name *
      </label>
      <input 
        id="provider-name"
        type="text" 
        pInputText 
        formControlName="name" 
        placeholder="My Apprise Provider"
        class="w-full" />
      <small *ngIf="hasError('name', 'required')" class="p-error">
        Provider name is required
      </small>
    </div>

    <!-- Apprise Server URL -->
    <div class="field">
      <label for="full-url">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="The URL of your Apprise server where notifications will be sent"></i>
        Apprise Server URL *
      </label>
      <input 
        id="full-url"
        type="url" 
        pInputText 
        formControlName="fullUrl" 
        placeholder="http://localhost:8000"
        class="w-full" />
      <small *ngIf="hasError('fullUrl', 'required')" class="p-error">Apprise server URL is required</small>
      <small *ngIf="hasError('fullUrl', 'pattern')" class="p-error">Please enter a valid URL (e.g., http://localhost:8000)</small>
      <small class="form-helper-text">The URL of your Apprise server where notifications will be sent.</small>
    </div>

    <!-- Configuration Key -->
    <div class="field">
      <label for="key">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="The key that identifies your Apprise configuration on the server"></i>
        Configuration Key *
      </label>
      <input 
        id="key"
        type="text" 
        pInputText 
        formControlName="key" 
        placeholder="my-config-key"
        class="w-full" />
      <small *ngIf="hasError('key', 'required')" class="p-error">Configuration key is required</small>
      <small *ngIf="hasError('key', 'minlength')" class="p-error">Key must be at least 2 characters</small>
      <small class="form-helper-text">The key that identifies your Apprise configuration on the server.</small>
    </div>

    <!-- Tags -->
    <div class="field">
      <label for="tags">
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Optional tags to filter notifications"></i>
        Tags (Optional)
      </label>
      <input 
        id="tags"
        type="text" 
        pInputText 
        formControlName="tags" 
        placeholder="tag1,tag2 or tag3 tag4"
        class="w-full" />
      <small class="form-helper-text">Optional tags to filter notifications. Use comma (,) to OR tags and space ( ) to AND them.</small>
    </div>

    <!-- Event Triggers Section -->
    <div class="field">
      <label>
        <i class="pi pi-question-circle field-info-icon" 
           pTooltip="Select which events trigger notifications"></i>
        Notification Events
      </label>
      <div class="grid">
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onFailedImportStrike" [binary]="true" inputId="on-failed-import-strike"></p-checkbox>
            <label for="on-failed-import-strike" class="ml-2">On Failed Import Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onStalledStrike" [binary]="true" inputId="on-stalled-strike"></p-checkbox>
            <label for="on-stalled-strike" class="ml-2">On Stalled Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onSlowStrike" [binary]="true" inputId="on-slow-strike"></p-checkbox>
            <label for="on-slow-strike" class="ml-2">On Slow Strike</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onQueueItemDeleted" [binary]="true" inputId="on-queue-item-deleted"></p-checkbox>
            <label for="on-queue-item-deleted" class="ml-2">On Queue Item Deleted</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onDownloadCleaned" [binary]="true" inputId="on-download-cleaned"></p-checkbox>
            <label for="on-download-cleaned" class="ml-2">On Download Cleaned</label>
          </div>
        </div>
        <div class="col-6">
          <div class="field-checkbox">
            <p-checkbox formControlName="onCategoryChanged" [binary]="true" inputId="on-category-changed"></p-checkbox>
            <label for="on-category-changed" class="ml-2">On Category Changed</label>
          </div>
        </div>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="modal-footer">
      <button 
        pButton 
        type="button" 
        label="Cancel" 
        class="p-button-text"
        (click)="onCancel()">
      </button>
      <button 
        pButton 
        type="button" 
        label="Test" 
        icon="pi pi-play"
        class="p-button-outlined ml-2"
        [disabled]="providerForm.invalid || testing"
        [loading]="testing"
        (click)="onTest()">
      </button>
      <button 
        pButton 
        type="button" 
        label="Save" 
        icon="pi pi-save"
        class="p-button-primary ml-2"
        [disabled]="providerForm.invalid || saving"
        [loading]="saving"
        (click)="onSave()">
      </button>
    </div>
  </ng-template>
</p-dialog>
